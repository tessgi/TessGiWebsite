<!DOCTYPE html>
<!--
Crafted with ♥ by Geert Barentsen, Thomas Barclay & Knicole colon at NASA Ames
in August 2015, using pelican-bootstrap and flatly.
-->
<html lang="en" >

<head>
    <title>Cosmic Ray Mitigation - TESS Science Support Center</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--Custom meta data-->

    <meta name="dc.title" content="NASA - TESS Science Support Center" />
    <meta name="dc.format" content="text/html" />
    <meta name="dc.date.modified" content="2024-02-02" />
    <meta name="dc.language" content="en" />
    <meta name="dc.description" content="Resources and Information for Users of TESS Data" />
    <meta name="dc.identifier" content="https://heasarc.gsfc.nasa.gov/docs/tess/" />
    <meta name="dc.audience" content="Astronomers, Astrophysicists, Scientists, Researchers" />
    <meta name="dc.subject.discipline" content="Astrophysics, Astronomy" />
    <meta name="orgcode" content="667">
    <meta name="rno" content="Thomas.Barclay">
    <meta name="content-owner" content="Thomas.Barclay">
    <meta name="webmaster" content="Thomas.Barclay">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:description"
        content="Transiting Exoplanet Survey Satellite is a NASA Mission to Study Stars, Planets and Galaxies." />
    <meta name="twitter:title" content="NASA - TESS Science Support Center" />
    <meta name="twitter:site" content="@NASA_TESS" />
    <meta name="twitter:creator" content="@NASA_TESS" />
    <meta name="twitter:image" content="https://heasarc.gsfc.nasa.gov/docs/tess/images/logo-for-twitter.jpeg" />


    <link href="./images/favicon.png" rel="icon">

<link rel="canonical" href="./pages/cosmic-ray-mitigation.html">

        <meta name="author" content="Thomas Barclay" />
        <meta name="description" content="Authors Christina Hedges - Director of the TESS GI Office Nicole Schanche - Support scientist in the TESS GI Office How does TESS handle cosmic rays? “Cosmic rays”, a general term for both Galactic cosmic rays and solar energetic particles, are high energy particles that can cause flux increases in pixels on …" />

    <meta property="og:site_name" content="TESS" />
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Cosmic Ray Mitigation"/>
    <meta property="og:url" content="./pages/cosmic-ray-mitigation.html"/>
    <meta property="og:description" content="Authors Christina Hedges - Director of the TESS GI Office Nicole Schanche - Support scientist in the TESS GI Office How does TESS handle cosmic rays? “Cosmic rays”, a general term for both Galactic cosmic rays and solar energetic particles, are high energy particles that can cause flux increases in pixels on …" />
        <meta property="og:image"
              content="./images/logo-for-twitter.jpeg"/>


    <link href="./theme/css/drn.css" rel="stylesheet">


    <!-- Why use Helvetica Neue when you can have Lato? -->
    <!-- Why use Lato when you can have Nunito? -->
    <link href="./theme/css/nunito.css" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="./theme/css/bootstrap.cosmo.min.css" type="text/css" />
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/exoplanet_archive_icons.css" rel="stylesheet">
    <link href="./theme/css/mission_icons.css" rel="stylesheet">
    <!--     <link href="./theme/css/photobanner.css" rel="stylesheet">
    <link href="./theme/css/slide-container.css" rel="stylesheet">
    <link href="./theme/css/slide-transition.css" rel="stylesheet">
    <link href="./theme/css/slide-transition2.css" rel="stylesheet">  -->

    <link href="./theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css" />

    <link href="./feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
        title="TESS ATOM Feed" />
    <link href="./feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
        title="TESS RSS Feed" />

</head>

<body>

    <!-- Print a warning message that this is not the official site -->
    <div class="container container-wide"
        style="background-color: #d35400; color: white; padding: 1.5em; font-weight: bold;">
        <div class="container">
            <i class="fa fa-warning fa-lg fa-margin"></i>
            This is the development version of the TESS Science Support Center website.
            For the live website, visit <a
                href="https://heasarc.gsfc.nasa.gov/docs/tess/">https://heasarc.gsfc.nasa.gov/docs/tess</a>
        </div>
    </div>


    <div class="navbar navbar-inverse navbar-fixed-top"
        role="navigation">

        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="./" class="navbar-brand">
<img src="./images/NASA_logo_vector_lg.png" width="32" /> TESS                </a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Mission <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="./objectives.html">Objectives</a></li>
                            <li><a href="./the-tess-space-telescope.html">Telescope</a></li>
                            <li><a href="./primary.html">Primary mission</a></li>
                            <li><a href="./extended.html">First Extended mission</a></li>
                            <li><a href="./second-extended.html">Second Extended mission</a></li>
                            <li><a href="./TUC.html">Users Committee</a></li>
                            <li><a href="./faq.html">FAQ</a></li>
                            <li><a href="./citizenscience.html">Citizen Science</a></li>
                            <li><a href="./gallery.html">Outreach resources</a></li>
                            <li><a href="./publications.html">Publications</a></li>
                            <li><a href="./media.html">Media Request</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Data & tools <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="./data-handling.html">Data pipeline</a></li>
                            <li><a href="./data-products.html">Data products</a></li>
                            <li><a href="./data-access.html">Data access</a></li>
                            <li><a href="./data-analysis-tools.html">Data analysis tools</a></li>
                            <li><a href="./community.html">Community products</a></li>
                            <li><a href="./community-tools.html">Community tools</a></li>
                            <li><a href="./documentation.html">Documentation</a></li>
                            <li><a href="./data_release_notes.html">Data release notes</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Observations <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="./observing-technical.html">Technical details</a></li>
                            <li><a href="./sector.html">Sector dates</a></li>
                            <li><a href="./approved-programs.html">Approved GI programs</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Proposing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="./proposing-investigations.html">Guest Investigator Proposals</a></li>
                            <li><a href="./proposal-tools.html">Proposal & observation tools</a></li>
                            <li><a href="./ddt.html">Director's Discretionary Target program</a></li>
                            <li><a href="./proposal-templates.html">Proposal templates</a></li>
                        </ul>
                    </li>
                </ul>

                <ul class="nav navbar-nav">
		  <li>
                    <a href="https://heasarc.gsfc.nasa.gov/wsgi-scripts/TESS/TESS-point_Web_Tool/TESS-point_Web_Tool/wtv_v2.0.py"><i class="fa fa-lg fa-margin exoplanet-icon-planet-confirmed-borderless"></i> TESS-point Web Tool</a>
                  </li>
                  <li>
                    <a href="./helpdesk.html"><i class="fa fa-info-circle fa-lg"></i> Helpdesk</a>
                  </li>
		    
		    
                </ul>

            </div>
            <!-- /.navbar-collapse -->
        </div>
    </div> <!-- /.navbar -->
    <!-- Banner -->
    <!-- End Banner -->

    <div class="container">
        <div class="row">
                <div class="col-lg-12">

    <div class="col-sm-12">
        <section id="content" class="body">
            <h1 class="entry-title">Cosmic Ray Mitigation</h1>
            <div class="entry-content">
                <div class="section" id="authors">
<h2>Authors</h2>
<p>Christina Hedges - Director of the TESS GI Office</p>
<p>Nicole Schanche - Support scientist in the TESS GI Office</p>
<div class="section" id="how-does-tess-handle-cosmic-rays">
<h3>How does TESS handle cosmic rays?</h3>
<p>“Cosmic rays”, a general term for both Galactic cosmic rays and solar
energetic particles, are high energy particles that can cause flux
increases in pixels on detectors of space telescopes like TESS (See
<a class="reference external" href="https://imagine.gsfc.nasa.gov/science/toolbox/cosmic_rays1.html">this
link</a>
for more information on Cosmic rays). These particles can either
directly cause an increase in flux by hitting the detector (a primary
event), or they can cause a cascade of other particles which themselves
cause spurious flux on the detector (secondary events). These particles
are always streaming through the TESS instruments, and so they impact
our data. Cosmic rays can look a lot like interesting astrophysical
variability, and so the TESS mission products use different methods to
handle them.</p>
<p>In this notebook you will learn about the different ways cosmic rays are
dealt with by TESS mission products, and learn how that might impact
your science with TESS data.</p>
</div>
<div class="section" id="introduction-to-tess-data-products">
<h3>Introduction to TESS data products</h3>
<p>TESS has three main data products. We will briefly discuss them here,
and lay out how cosmic rays are addressed in the data files.</p>
<p>Full Frame Images (FFIs): An FFI is the full set of all science and
collateral pixels across all four CCDs of a given camera. In the prime
mission (Cycles 1 and 2), they had a cadence of 30 minutes, then 10
minutes in the first extension (Cycles 3 and 4), and 200 seconds in the
second extension (Cycle 5+). The images are built up from 2-second
exposures, with Cosmic Ray Mitigation (CRM) being implemented onboard as
described in Section 1.</p>
<p>Target Pixel Files (TPFs): These are cutouts of the pixels surrounding
pre-selected targets of interest and are created on the ground. TPFs
have a cadence of 120 seconds only in the primary mission, but from the
extended mission onwards they may also have a cadence of 20 seconds.
Cosmic Ray Mitigation is applied onboard for 120-second targets, but not
for 20-second targets.</p>
<p>Lightcurves (LC): Files containing the brightness of a given target over
time for pre-selected targets. Lightcurves are created by combining the
flux within a given aperture around the target on the TPF. These have
cadences of either 2 minutes or, beginning in the extended mission, 20
seconds.</p>
<p>The TPFs and LCs are created by the Science Processing Operations Center
(SPOC) pipeline using raw data from TESS. The SPOC is located at NASA
Ames and the pipeline, based on that developed for Kepler (see Jenkins
2016), is used to process and correct the raw TESS data. LCs created
from 120 second cadence TPF data have already been corrected for cosmic
rays, and as such need no further CRM. LCs created from 20-second
cadence data undergo an extra step of processing by SPOC in which cosmic
rays are identified and removed. See Section 2 for further details.</p>
</div>
<div class="section" id="method-1-cosmic-ray-mitigation">
<h3>Method 1: Cosmic Ray Mitigation</h3>
<p>Cosmic Ray Mitigtaion (CRM) is a strategy employed by TESS during data
collection. The strategy is intended to remove large outliers created by
cosmic ray impacts from the pixel data. CRM is applied to each pixel in
the following steps:</p>
<ul class="simple">
<li>Data are collected from the CCDs every two seconds. FFI and shorter
cadence data are created by summing 2s images.</li>
<li>For each pixel, the spacecraft computer identifies and removes both
the brightest and faintest value in groups of 10 exposures.</li>
<li>The values of the remaining 8 exposures are summed and used to create
the relevant data product, i.e.&nbsp;the above procedure is completed 6
times and coadded to create the 120 second cadence TPFs with 96
second total integration time. The procedure is 10 times and co-added
to create 200 second FFIs for Cycles 5+, 30 times for the 10 minute
FFIs during the first extended mission, and 90 times to create one
30-minute FFI during the prime mission, resulting in 160-second, and
480-second, and 1440-second integration times respectively.</li>
</ul>
<p>Below is a representation of what occurs on-board, for each pixel for
each 20 second frame</p>
<pre class="code ipython3 literal-block">
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="w">
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span><span class="w">
</span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'seaborn-white'</span><span class="p">)</span>
</pre>
<pre class="code ipython3 literal-block">
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="w">

</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span><span class="w">
</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Kept Cadences'</span><span class="p">)</span><span class="w">
</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="n">c</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Removed Cadences'</span><span class="p">)</span><span class="w">

</span><span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">'dashed'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'mean (with outliers)'</span><span class="p">)</span><span class="w">
</span><span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">f</span><span class="p">)])),</span> <span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">'dashed'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'mean (removed outliers)'</span><span class="p">)</span><span class="w">

</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span><span class="w">
</span><span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Time [seconds]'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'Measured Flux'</span><span class="p">)</span><span class="w">
</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper center'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">),</span><span class="w">
</span>          <span class="n">fancybox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.legend.Legend at 0x11da401f0&gt;
</pre>
<img alt="" src="images/CRM_demo.png" />
<p>CRM is “baked in” to the data, it can not be removed, and it can not be
reversed.</p>
<p><strong>Crucially, for 20-second TPF data taken by the mission and delivered,
this strategy is not employed.</strong> 20 second data consists of 10 co-added
2 second frames, with no frames removed.</p>
<p>In addition, for every 20-second TPF, a 120-second TPF (with on-board
CRM) is also created and archived. Meaning, for any target with 20
second TESS data there is:</p>
<ul class="simple">
<li>A 20-second TPF without on-board Cosmic Ray Mitigation</li>
<li>A 20-second LC, made from the 20-second TPF, without on-board CRM</li>
<li>A 120-second TPF with on-board Cosmic Ray Mitigation</li>
<li>A 120-second LC, made from the 120-second TPF, with on-board CRM</li>
</ul>
<p>Because of this, simply coadding the 20-second data from TESS will not
produce exactly the 120 second data.</p>
<p>After the 20-second data is on the ground, cosmic rays are removed using
a different method during processing with SPOC. Therefore any SPOC TPF
or LC products you download will have cosmic ray correction that <em>is</em>
reversable. The details of this process will be discussed in more detail
in Section 2 below.</p>
</div>
<div class="section" id="what-are-the-impacts-of-cosmic-ray-mitigation">
<h3>What are the impacts of Cosmic Ray Mitigation?</h3>
<p>CRM has many impacts on the data products that you get, here are some of
the key impacts:</p>
<ul class="simple">
<li><strong>Cosmic rays in the data are significantly reduced.</strong> Large, single
cadence deviations are removed.</li>
<li><strong>The raw target flux from data with on-board CRM is 80% of the true
flux, because 20% of the data is removed by CRM.</strong> The TESS mission
pipeline corrects for this in the light curve data products delivered
to the archive.</li>
<li><strong>Extremely fast, asymmetric, astrophysical variability (on
time-scales of 20 seconds or less) may be adveresly affected.</strong> The
CRM might, for example, remove extremely short term stellar flares.</li>
<li><strong>The noise distributions of the data are affected.</strong> Because cosmic
rays do not occur in every 20 second co-add, the CRM will alter the
pixel time-series of the true target flux. This can impact the noise
distribution and properties of the target.</li>
</ul>
</div>
<div class="section" id="method-2-spoc-pipeline-cosmic-ray-identification-and-removal">
<h3>Method 2: SPOC Pipeline Cosmic Ray Identification and Removal</h3>
<p>Once data is received on the ground, it is processed by the TESS
pipeline. Because CRM is not used on board for 20 second data, the SPOC
pipeline runs an additional step on these data to identify cosmic rays
and remove them. The removed cosmic rays are stored in the FITS file and
can be accessed and added back to the TPF if desired. To briefly
summarize the process, cosmic rays are:</p>
<ul class="simple">
<li>Identified in each 20-second image.</li>
<li>In images where there is a cosmic ray identified, the amplitude of
the cosmic ray in each pixel is recorded.</li>
<li>Cosmic rays are removed (subtracted) from the pixel level data.</li>
<li>The time, pixel positions, and flux value removed are recorded to an
array as an extension to the fits file.</li>
</ul>
<p>Below is an example of the information in the cosmic ray extension. For
further details on the process, see the <a class="reference external" href="https://archive.stsci.edu/missions/tess/doc/tess_drn/tess_sector_27_drn38_v02.pdf">data release notes from Sector
27</a>,
Section 4.1.</p>
<pre class="code ipython3 literal-block">
<span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span><span class="w">
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="w">
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span><span class="w">

</span><span class="k">def</span> <span class="nf">load_cosmicray_extension</span><span class="p">(</span><span class="n">tpf</span><span class="p">):</span><span class="w">
    </span><span class="sd">&quot;&quot;&quot;Function to load the cosmic ray extension into a datacube

    Parameters:
    -----------
    tpf: lk.TargetPixelFile
        Input Target Pixel File

    Returns:
    -------
    cr: np.ndarray
        Array containing cosmic ray fluxes of shape tpf.shape
    &quot;&quot;&quot;</span><span class="w">
</span>    <span class="n">cadenceno</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">cadenceno</span><span class="p">)</span><span class="w">

</span>    <span class="c1"># Get cosmic ray information</span><span class="w">
</span>    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">([</span><span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">'TARGET COSMIC RAY'</span> <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="n">tpf</span><span class="o">.</span><span class="n">hdu</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="w">
</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span><span class="w">
</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TPF product has no cosmic ray extension.&quot;</span><span class="p">)</span><span class="w">
</span>    <span class="n">hdu</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="w">
</span>    <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'CADENCENO'</span><span class="p">,</span> <span class="s1">'RAWX'</span><span class="p">,</span> <span class="s1">'RAWY'</span><span class="p">,</span> <span class="s1">'COSMIC_RAY'</span><span class="p">]]</span><span class="w">
</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="w">
</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No cosmic rays identified. Is this a 20-second dataset?&quot;</span><span class="p">)</span><span class="w">
</span>    <span class="n">x</span> <span class="o">-=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">column</span><span class="w">
</span>    <span class="n">y</span> <span class="o">-=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">row</span><span class="w">

</span>    <span class="c1"># Mask down to only cosmic rays in cadences within the TPF</span><span class="w">
</span>    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">cadenceno</span><span class="p">)</span><span class="w">
</span>    <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w">

</span>    <span class="c1"># Map cosmic ray cadences to array indices</span><span class="w">
</span>    <span class="n">r</span> <span class="o">=</span> <span class="p">{</span><span class="n">cadenceno</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span><span class="w">
</span>    <span class="n">inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="n">c1</span><span class="p">]</span> <span class="k">for</span> <span class="n">c1</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span><span class="w">

</span>    <span class="c1"># Build a cube</span><span class="w">
</span>    <span class="n">cr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="w">
</span>    <span class="n">cr</span><span class="p">[</span><span class="n">inv</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="w">
</span>    <span class="k">return</span> <span class="n">cr</span>
</pre>
<p>In the example below, we make use of a TPF file. If you need a refresher
on how to handle TPF files before proceeding, check out <a class="reference external" href="https://docs.lightkurve.org/tutorials/1-getting-started/what-are-targetpixelfile-objects.html">this
tutorial</a>.</p>
<pre class="code ipython3 literal-block">
<span class="c1">#Get an example 20-s TPF file</span><span class="w">
</span><span class="n">tpf</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_targetpixelfile</span><span class="p">(</span><span class="s1">'Kepler 10'</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="s1">'TESS'</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s1">'SPOC'</span><span class="p">,</span> <span class="n">exptime</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
</pre>
<pre class="code ipython3 literal-block">
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre>
<pre class="literal-block">
&lt;AxesSubplot:title={'center':'Target ID: 377780790, Cadence: 5025018'}, xlabel='Pixel Column Number', ylabel='Pixel Row Number'&gt;
</pre>
<img alt="" src="images/TPF_cosmic_ray_primer.png" />
<pre class="code ipython3 literal-block">
<span class="c1">#Get the cosmic ray data using the function we defined above</span><span class="w">
</span><span class="n">cosmic_ray_cube</span> <span class="o">=</span> <span class="n">load_cosmicray_extension</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span>
</pre>
<pre class="code ipython3 literal-block">
<span class="c1">#Plot some random examples of the CRs in the data</span><span class="w">
</span><span class="n">ax_num</span> <span class="o">=</span> <span class="mi">0</span><span class="w">
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span><span class="w">
</span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span><span class="w">
</span>    <span class="c1">#only plot if a CR was found in the frame</span><span class="w">
</span>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cosmic_ray_cube</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span><span class="w">
</span>        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">ax_num</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cosmic_ray_cube</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span><span class="w">
</span>        <span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">ax_num</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Pixel Column'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'Pixel Row'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">'Cosmic Ray Extension'</span><span class="p">)</span><span class="w">
</span>        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">ax_num</span><span class="p">])</span><span class="w">
</span>        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Counts [e$^-$/s]'</span><span class="p">)</span><span class="w">
</span>        <span class="n">ax_num</span> <span class="o">+=</span><span class="mi">1</span><span class="w">
</span>        <span class="c1">#Stop after plotting 6</span><span class="w">
</span>        <span class="k">if</span> <span class="n">ax_num</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span><span class="w">
</span>            <span class="k">break</span><span class="w">

</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
<img alt="" src="images/Cosmic_ray_examplegrid.png" />
<p>The cosmic ray extension can be used to re-inject the cosmic rays into
the pixel data. For example, using the pipeline processed pixels we can
simply add the cosmic rays back into the simple aperture photometry
<a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/tess/LightCurveFile-Object-Tutorial.html">(SAP)</a>.</p>
<pre class="code ipython3 literal-block">
<span class="n">lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">tpf</span><span class="o">.</span><span class="n">pipeline_mask</span><span class="p">)</span><span class="w">
</span><span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre>
<pre class="literal-block">
&lt;AxesSubplot:xlabel='Time - 2457000 [BTJD days]', ylabel='Flux [$\mathrm{e^{-}\,s^{-1}}$]'&gt;
</pre>
<img alt="" src="images/SAP_without_CR.png" />
<pre class="code ipython3 literal-block">
<span class="n">tpf_with_cr</span> <span class="o">=</span> <span class="p">(</span><span class="n">tpf</span> <span class="o">+</span> <span class="n">cosmic_ray_cube</span><span class="p">)</span><span class="w">
</span><span class="n">lc_with_cr</span> <span class="o">=</span> <span class="n">tpf_with_cr</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">tpf</span><span class="o">.</span><span class="n">pipeline_mask</span><span class="p">)</span><span class="w">
</span><span class="n">ax</span> <span class="o">=</span> <span class="n">lc_with_cr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'SAP flux, with cosmic rays'</span><span class="p">)</span><span class="w">
</span><span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'SAP flux, without cosmic rays'</span><span class="p">)</span><span class="w">
</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">9000</span><span class="p">,</span><span class="mi">20000</span><span class="p">)</span>
</pre>
<pre class="literal-block">
(9000.0, 20000.0)
</pre>
<img alt="" src="images/SAP_with_CR.png" />
<p>The cosmic rays that are removed are stored in the TPF files. In order
to add CRs back into a LC directly, you would need to sum the CR flux in
all pixels of the photometric aperture. For the SAP flux, you can simply
add this flux in. However, for the corrected Presearch Data Conditioning
SAP
<a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/tess/LightCurveFile-Object-Tutorial.html">(PDC-SAP)</a>
lightcurves, you will need to normalize the cosmic ray correction by an
extra factor for all pixels within the chosen aperture as follows:</p>
<p><span class="formula"><i>f</i>’<sub><i>PDCSAP</i>_<i>flux</i></sub>(<i>n</i>) = <i>f</i><sub><i>PDCSAP</i>_<i>flux</i></sub>(<i>n</i>) + <span class="fullfraction"><span class="ignored">(</span><span class="numerator">Δ<i>f</i>(<i>n</i>)</span><span class="ignored">)/(</span><span class="denominator"><i>FLFRCSAP</i></span><span class="ignored">)</span></span></span></p>
<p>where <span class="formula"><i>f</i>’<sub><i>PDCSAP</i>_<i>flux</i></sub>(<i>n</i>)</span> is the UNCORRECTED flux (ie, with
cosmic rays injected back in), <span class="formula"><i>f</i><sub><i>PDCSAP</i>_<i>flux</i></sub>(<i>n</i>)</span> is the
PDC-SAP corrected flux, <span class="formula">Δ<i>f</i>(<i>n</i>)</span> is the flux removed by the
cosmic ray correction, and FLFRCSAP is the flux fraction correction. The
latter value is stored in the LC and TPF binary table headers.</p>
<p>Additional outliers caused by uncorrected cosmic rays may still remain,
particularly when the target is bright. In this case, the suspected CRs
will be labeled with a data quality bit of 10 (quality value = 512) as
impulsive outliers. Users should consider their science objectives and
determine whether or not these outliers should be masked.</p>
</div>
<div class="section" id="conclusion">
<h3>Conclusion</h3>
<p>Cosmic rays are frequently seen in TESS data. The on-board cosmic ray
mitigation system is effective at removing the majority of cosmic rays
for FFI images and 120-second TPF and LCs. The on-board CRM system is
not run for the 20-second data product, but rather cosmic arrays are
corrected for by the SPOC pipeline.</p>
<p>If you are an astronomer mostly interested in variability on time-scales
much longer than 20 seconds, you are likely to only benefit from data
that uses Cosmic Ray Mitigation. CRM will largely make your data less
susceptible to significant upwards outliers.</p>
<p>If you are an astronomer mostly interested in short term flares or other
impulsive events with time scales on the order of 20 seconds or less,
CRM may hamper your investigations. Users may wish to use the TPF
<em>without</em> cosmic rays removed and build a model that accounts for cosmic
rays in their detection pipeline. In this case we recommend that you
propose to the TESS General Investigator program to obtain 20 second
data of your targets of interest. However, 20 second targets are a
limited resource as they are a large volume of data, so there is more
competition for those resources.</p>
</div>
</div>

            </div>
        </section>
    </div>

                </div>
            </div>
        </div>

<div class="container container-wide" style="margin-top: 1.5em;">
  <footer>

     <div class="container">

      <!-- Partner logos -->  
      <div class="row">
        <div class="col-md-10"> 
          <a href="http://tess.mit.edu/"><img src="./images/partners/mit-logo.png" width="80" alt="MIT Logo"></a> &nbsp;&nbsp;&nbsp;
         <a href="http://www.nasa.gov/"><img src="./images/NASA_logo_vector_lg.png" width="60" alt="NASA Logo"></a> &nbsp;&nbsp;&nbsp;
         <a href="https://www.cfa.harvard.edu/"><img src="./images/partners/CfA_Horizontal_CMYK.png" width="176" alt="CfA Logo"></a> &nbsp;&nbsp;&nbsp;
<!--          <a href="https://www.ll.mit.edu/"><img src="./images/partners/lincoln-laboratory.png" width="50" alt="Lincoln Labs Logo"></a> &nbsp;&nbsp;&nbsp; -->
         <a href="https://http://www.northropgrumman.com/"><img src="./images/partners/Northrop_Grumman.png" width="176" alt="Orbital ATK Logo"></a> &nbsp;&nbsp;&nbsp;
         <a href="http://www.stsci.edu/"><img src="./images/partners/stsci_logo2.png" width="110" alt="STScI Logo"></a> 
        </div>
      </div>

      
      <!-- Related websites -->  
      <div class="row">
        <div class="col-xs-12">
          <h5><i class="fa fa-external-link"></i><span class="icon-label">Related websites:</span></h5>
          <a href="https://nasa.gov/tess" target="_blank">
                  News, Media, and Education Resources
              </a>
          <br/>
          <a href="http://tess.mit.edu/" target="_blank">
                  TESS @ MIT
              </a>
          <br/>
          <a href="http://archive.stsci.edu/tess" target="_blank">
                  TESS @ MAST
              </a>
          <br/>
          <a href="https://heasarc.gsfc.nasa.gov/" target="_blank">
                  High Energy Astrophysics Science Archive Research Center
              </a>
          <br/>
          <a href="http://exoplanetarchive.ipac.caltech.edu" target="_blank">
                  NASA Exoplanet Archive @ IPAC
              </a>
          <br/>
        </div>
      </div>

      <!-- NASA logo and notices -->
      <div class="row" style="margin-top:2em;">
         <div class="col-md-10"> <a href="http://www.nasa.gov/"><img src="./images/NASA_logo_vector_lg.png" width="30" alt="NASA Logo"></a> 
         Last modified: Fri 05 January 2024
            &middot; Editor: Thomas Barclay &middot; NASA Official: Patricia T Boyd 
            &middot; <a href="http://www.nasa.gov/about/highlights/HP_Privacy.html">Privacy Policy and Important Notices</a><p></p>         </div>
         <div class="col-md-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
    </div>

  </footer>
</div>

        <script src="./theme/js/jquery.min.js"></script>

        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="./theme/js/bootstrap.min.js"></script>

        <!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
        <script src="./theme/js/respond.min.js"></script>

        <script src="./theme/js/bodypadding.js"></script>
<!-- Analytics scripts -->

        <script src="./theme/js/drn.js"></script>

</body>

</html>