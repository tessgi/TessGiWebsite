<!DOCTYPE html>
<!--
Crafted with ♥ by Geert Barentsen, Thomas Barclay & Knicole colon at NASA Ames
in August 2015, using pelican-bootstrap and flatly.
-->
<html lang="en"
>

<head>
    <title>Noise Removal - TESS Science Support Center</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--Custom meta data-->

    <meta name="dc.title" content="NASA - TESS Science Support Center" />
    <meta name="dc.format" content="text/html" />
    <meta name="dc.date.modified" content="2022-09-22" />
    <meta name="dc.language" content="en" />
    <meta name="dc.description" content="Resources and Information for Users of TESS Data" />
    <meta name="dc.identifier" content="https://heasarc.gsfc.nasa.gov/docs/tess/" />
    <meta name="dc.audience" content="Astronomers, Astrophysicists, Scientists, Researchers" />
    <meta name="dc.subject.discipline" content="Astrophysics, Astronomy" />
    <meta name="orgcode" content="667">
    <meta name="rno" content="Thomas.Barclay">
    <meta name="content-owner" content="Thomas.Barclay">
    <meta name="webmaster" content="Thomas.Barclay">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:description" content="Transiting Exoplanet Survey Satellite is a NASA Mission to Study Stars, Planets and Galaxies." />
    <meta name="twitter:title" content="NASA - TESS Science Support Center" />
    <meta name="twitter:site" content="@NASA_TESS" />
    <meta name="twitter:creator" content="@NASA_TESS" />
    <meta name="twitter:image" content="https://heasarc.gsfc.nasa.gov/docs/tess/images/logo-for-twitter.jpeg" />


    <link href="./images/favicon.png" rel="icon">

<link rel="canonical" href="./pages/noise-removal.html">

        <meta name="author" content="Thomas Barclay" />
        <meta name="description" content="An introduction into the Lightkurve Corrector Class - Noise removal for TESS light curves Welcome everyone to our TESS Lightkurve splinter session! Authors Rebekah Hounsell - Support scientist for TESS in the NASA GSFC GI Office. Download the notebook If you would like to download a copy of this notebook you can …" />

    <meta property="og:site_name" content="TESS" />
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Noise Removal"/>
    <meta property="og:url" content="./pages/noise-removal.html"/>
    <meta property="og:description" content="An introduction into the Lightkurve Corrector Class - Noise removal for TESS light curves Welcome everyone to our TESS Lightkurve splinter session! Authors Rebekah Hounsell - Support scientist for TESS in the NASA GSFC GI Office. Download the notebook If you would like to download a copy of this notebook you can …" />
        <meta property="og:image"
              content="./images/logo-for-twitter.jpeg"/>


    <link href="./theme/css/drn.css" rel="stylesheet">


    <!-- Why use Helvetica Neue when you can have Lato? -->
    <!-- Why use Lato when you can have Nunito? -->
    <link href="./theme/css/nunito.css" rel="stylesheet">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/exoplanet_archive_icons.css" rel="stylesheet">
    <link href="./theme/css/mission_icons.css" rel="stylesheet">
<!--     <link href="./theme/css/photobanner.css" rel="stylesheet">
    <link href="./theme/css/slide-container.css" rel="stylesheet">
    <link href="./theme/css/slide-transition.css" rel="stylesheet">
    <link href="./theme/css/slide-transition2.css" rel="stylesheet">  -->

    <link href="./theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>

    <link href="./feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="TESS ATOM Feed"/>
    <link href="./feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="TESS RSS Feed"/>

</head>
<body>

<!-- Print a warning message that this is not the official site -->

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">

  <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
<img src="./images/NASA_logo_vector_lg.png" width="32"/> TESS            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-nav">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Mission <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="./objectives.html">Objectives</a></li>
                                <li><a href="./the-tess-space-telescope.html">Telescope</a></li>
                                <li><a href="./primary.html">Primary mission</a></li>
                                <li><a href="./extended.html">First Extended mission</a></li>
                                <li><a href="./second-extended.html">Second Extended mission</a></li>
                                <li><a href="./faq.html">FAQ</a></li>
                                <li><a href="./citizenscience.html">Citizen Science</a></li>
                                <li><a href="./gallery.html">Outreach resources</a></li>
                                <li><a href="./publications.html">Publications</a></li>
                                <li><a href="./media.html">Media Request</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Data & tools <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="./data-handling.html">Data pipeline</a></li>
                                <li><a href="./data-products.html">Data products</a></li>
                                <li><a href="./data-access.html">Data access</a></li>
                                <li><a href="./data-analysis-tools.html">Data analysis tools</a></li>
                                <li><a href="./community.html">Community products</a></li>
                                <li><a href="./community-tools.html">Community tools</a></li>
                                <li><a href="./documentation.html">Documentation</a></li>
                                <li><a href="./data_release_notes.html">Data release notes</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Observations <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="./observing-technical.html">Technical details</a></li>
                                <li><a href="./sector.html">Sector dates</a></li>
                                <li><a href="./approved-programs.html">Approved GI programs</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Proposing <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="./proposing-investigations.html">Guest Investigator Proposals</a></li>
                                <li><a href="./proposal-tools.html">Proposal & observation tools</a></li>
                                <li><a href="./ddt.html">Director's Discretionary Target program</a></li>
                                <li><a href="./proposal-templates.html">Proposal templates</a></li>
                            </ul>
                        </li>
            </ul>

            <ul class="nav navbar-nav">
                <li>
                    <a href="./helpdesk.html"><i class="fa fa-info-circle fa-lg"></i> Helpdesk</a>
                </li>
            </ul>

        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->

<div class="container">
    <div class="row">
        <div class="col-lg-12">

    <div class="col-sm-12">
        <section id="content" class="body">
            <h1 class="entry-title">Noise Removal</h1>
            <div class="entry-content">
                <div class="section" id="an-introduction-into-the-lightkurve-corrector-class-noise-removal-for-tess-light-curves">
<h2>An introduction into the Lightkurve Corrector Class - Noise removal for TESS light curves</h2>
<p>Welcome everyone to our <em>TESS</em> Lightkurve splinter session!</p>
<div class="section" id="authors">
<h3>Authors</h3>
<p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/tess/helpdesk.html">Rebekah
Hounsell</a> -
Support scientist for <em>TESS</em> in the NASA GSFC GI Office.</p>
<img alt="" src="images/helpdesk.png" />
</div>
</div>
<div class="section" id="download-the-notebook">
<h2>Download the notebook</h2>
<p>If you would like to download a copy of this notebook you can do so by clicking the link below</p>
<p><a class="reference download internal" href="https://tessgi.github.io/TessGiWebsite/docs/tutorials/NoiseRemoval.ipynb">
<tt class="xref download docutils literal">
DOWNLOAD
</tt></a><p><div class="section" id="learning-goals">
<h3>Learning Goals</h3>
<p>In this tutorial, we will teach the user how to remove scattered light
and noise from a <em>TESS</em> light curve.</p>
<p>The splinter session assumes a basic knowledge of python and astronomy,
and will walk the user through several of the concepts outlined below,</p>
<ol class="arabic simple">
<li>How to use <em>Lightkurve</em> to access the various data products and
create time series.</li>
<li>How to account for instrumental and noise effects within your data
using the Corrector class.</li>
</ol>
<p>This tutorial is designed for users that have previous experience with
<em>Lightkurve</em>.</p>
</div>
<div class="section" id="imports">
<h3>Imports</h3>
<p>This tutorial requires the use of specific packages: -
<a class="reference external" href="https://docs.lightkurve.org/index.html">Lightkurve</a> to work with
<em>TESS</em> data (v2.0.1) - <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> for
plotting. - <a class="reference external" href="https://numpy.org">Numpy</a> for manipulating the data.</p>
</div>
<div class="section" id="first-time-users">
<h3>First time users</h3>
<p>If you are not that experienced with <em>Python</em>, or cannot download
<em>Lightkurve</em>, you can run this notebook as a <a class="reference external" href="https://colab.research.google.com/notebooks/intro.ipynb?utm_source=scs-index">Colab
notebook</a>.
Colaboratory allows users to write and execute <em>Python</em> in your browser
with zero configuration required.</p>
<p>All you need is a Google account and to copy and paste in the following
command at the top of your colab notebook:</p>
<p><tt class="docutils literal">!pip install lightkurve</tt></p>
<p>This downloads the <em>Lightkurve</em> package.</p>
<pre class="code ipython3 literal-block">
<span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre>
</div>
<div class="section" id="introduction-to-the-corrector-class">
<h3>Introduction to the Corrector Class</h3>
<p><em>TESS</em> light curves can often have systematic trends caused by noise
sources such as scattered light and instrumental effects. Only the
<a class="reference external" href="https://docs.lightkurve.org/tutorials/1-getting-started/what-are-lightcurve-objects.html">LightCurve
objects</a>
which have been fully processed, have had these effects removed. Data
derived from either
<a class="reference external" href="https://docs.lightkurve.org/tutorials/1-getting-started/what-are-targetpixelfile-objects.html">TargetPixelFiles</a>
or Full Frame Images must undergo further processing by the user to
remove these sources of noise.</p>
<p>To aid the user in this process, there exist several different tools
within the <em>Lightkurve</em> package. These are known as the <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.corrector.Corrector.html?highlight=corrector%20class#lightkurve-correctors-corrector-corrector">Corrector
class</a>.
We briefly describe each of these corrector classes below,</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.CBVCorrector.html?highlight=cbvcorrector">CBVCorrector</a>:
Cotrending Basis Vectors (CBVs) are generated from the most common
systematic trends observed in each Sector. Each <em>TESS</em> CCD and Camera
has its own set of CBVs. There are three basic types of CBVs,<ul>
<li><strong>Single-Scale</strong>: Contains all systematic trends combined in a
single set of basis vectors. Generally speaking, a single-scale
CBV performs better at preserving longer period signals.</li>
<li><strong>Multi-Scale</strong>: Contains systematic trends in specific
wavelet-based band passes. There are usually three sets of
multi-scale basis vectors in three bands. This type of correction
performs better when the periods are close to the transiting
planet durations, and help to preserve the signal.</li>
<li><strong>Spike</strong>: Contains only short impulsive spike systematics. This
correction is applied to remove short impulsive systematic
signals.</li>
</ul>
</li>
<li><a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.RegressionCorrector.html?highlight=regressioncorrector">RegressionCorrector</a>:
Here the light curve is de-trended against vectors that we think are
predictive of the systematic noise. For FFI data, we have to
select/define an aperture for our object of interest. Pixels outside
of this aperture are used to create vectors that are predictive of
the noise. These vectors are then removed from the data.</li>
<li><a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.html?highlight=pldcorrector">PLDCorrector</a>:
Pixel Level De-correlation (PLD) works by identifying a set of trends
in the pixels surrounding the target star, and performing linear
regression to create a combination of these trends that effectively
models the systematic noise introduced by spacecraft motion/scattered
light. This noise model is then subtracted from the uncorrected light
curve. It is similar to the RegressionCorrector.</li>
</ul>
<p>In this tutorial, we will apply each of these methods to our data and
compare the results. First, we need to obtain the data to test our
various Corrector functions.</p>
</div>
<div class="section" id="how-to-use-lightkurve-to-access-the-various-data-products-and-create-a-time-series">
<h3>1. How to use <em>Lightkurve</em> to access the various data products and create a time series</h3>
<p><a class="reference external" href="https://docs.lightkurve.org/tutorials/index.html">Lightkurve</a> offers
a user-friendly way to analyze time series data obtained by telescopes,
in particular <em>TESS</em>. You can search for the various data products for
<em>TESS</em> on MAST using the following <em>Lightkurve</em> functions.</p>
<ul class="simple">
<li>To look for your object in a full frame image:
<tt class="docutils literal">`search_tesscut()</tt> &lt;<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.search_tesscut.html?highlight=search_tesscut">https://docs.lightkurve.org/reference/api/lightkurve.search_tesscut.html?highlight=search_tesscut</a>&gt;`__</li>
<li>To look for target pixel files:
<tt class="docutils literal">`search_targetpixelfile()</tt> &lt;<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.search_targetpixelfile.html?highlight=search_targetpixelfile">https://docs.lightkurve.org/reference/api/lightkurve.search_targetpixelfile.html?highlight=search_targetpixelfile</a>&gt;`__</li>
<li>To obtain light curve files for your object of interest:
<tt class="docutils literal">`search_lightcurve()</tt> &lt;<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.search_lightcurve.html?highlight=search_lightcurve">https://docs.lightkurve.org/reference/api/lightkurve.search_lightcurve.html?highlight=search_lightcurve</a>&gt;`__</li>
</ul>
<p>For the purpose of this tutorial, we will be examining <a class="reference external" href="https://en.wikipedia.org/wiki/KT_Eridani">KT
Eri</a>, a bright nova in the
constellation Eridanus that underwent an eruption in 2009.</p>
<p>To test our various methods of noise removal, we will be looking at FFI
data for this object. We can search <a class="reference external" href="https://mast.stsci.edu">MAST</a>
for TESS FFI data on this object using the
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.search_tesscut.html?highlight=search_tesscut#lightkurve.search_tesscut">search_tesscut()</a>
function.</p>
<pre class="code ipython3 literal-block">
<span class="n">search_lc</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_tesscut</span><span class="p">(</span><span class="s2">&quot;KT Eri&quot;</span><span class="p">)</span>
<span class="n">search_lc</span>
</pre>
SearchResult containing 2 data products.

<table id="table140247469548816">
<thead><tr><th>#</th><th>mission</th><th>year</th><th>author</th><th>exptime</th><th>target_name</th><th>distance</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th>s</th><th></th><th>arcsec</th></tr></thead>
<tr><td>0</td><td>TESS Sector 05</td><td>2018</td><td><a href='https://mast.stsci.edu/tesscut/'>TESScut</a></td><td>1426</td><td>KT Eri</td><td>0.0</td></tr>
<tr><td>1</td><td>TESS Sector 32</td><td>2020</td><td><a href='https://mast.stsci.edu/tesscut/'>TESScut</a></td><td>475</td><td>KT Eri</td><td>0.0</td></tr>
</table><p>We see that there are two sets of data, one from Sector 5 and the other
from Sector 32. Let’s look at the data from Sector 32. To download the
data we must specify a cut out size in pixels and use the
<a class="reference external" href="https://docs.lightkurve.org/reference/search.html?highlight=download">download()</a>
function.</p>
<pre class="code ipython3 literal-block">
<span class="n">S32</span> <span class="o">=</span> <span class="n">search_lc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">cutout_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">S32</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8da8e321d0&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_10_1.png" />
<p>Note that this cut out is much larger than a typical FFI, this is
because when calculating our noise and systematics, we want a larger
sample of pixels from which the correction will be applied.</p>
<p><strong>Creating our light curve</strong></p>
<p>Great! Now we have our data, we can create our light curve using the
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.KeplerTargetPixelFile.to_lightcurve.html?highlight=to_lightcurve#lightkurve.KeplerTargetPixelFile.to_lightcurve">to_lightcurve()</a>
function. Our object is in the center, but it is kind of faint in
comparison to some other objects. We must therefore create our own
aperture as shown below.</p>
<pre class="code ipython3 literal-block">
<span class="n">aper_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">S32</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">aper_new</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span> <span class="mi">24</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">S32</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">aper_new</span><span class="p">,</span> <span class="n">mask_color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8dd96dcfd0&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_13_1.png" />
<p>Excellent it covers our object! Let’s now make our light curve using
this aperture and plot the result.</p>
<pre class="code ipython3 literal-block">
<span class="n">lc_S32</span> <span class="o">=</span> <span class="n">S32</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="s1">'threshold'</span><span class="p">)</span>
<span class="n">lc_S32</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;S32 FFI lc&quot;</span><span class="p">)</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8dd96dccd0&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_15_1.png" />
</div>
<div class="section" id="how-to-account-for-instrumental-and-noise-effects-within-your-data-using-the-corrector-class">
<h3>2. How to account for instrumental and noise effects within your data using the Corrector class</h3>
<p>We can see from the above plot that our light curve is severely affected
by scattered light, which needs to be removed. To remove this noise,
let’s try our first method,</p>
<div class="section" id="the-cbvcorrector">
<h4>The CBVCorrector</h4>
<p>Here we will use CBVs to remove our noise.</p>
<p>Check out our <a class="reference external" href="https://docs.lightkurve.org/tutorials/2-creating-light-curves/2-3-how-to-use-cbvcorrector.html">CBV
tutorial</a>
for more information.</p>
<p>First, we must import the <em>CBVCorrector</em> from <em>lightkurve.correctors</em>,
and then we can refer to our generate light curve.</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">lightkurve.correctors</span> <span class="kn">import</span> <span class="n">CBVCorrector</span>
<span class="n">cbvCorrector</span> <span class="o">=</span> <span class="n">CBVCorrector</span><span class="p">(</span><span class="n">lc_S32</span><span class="p">,</span> <span class="n">interpolate_cbvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cbvCorrector</span><span class="o">.</span><span class="n">cbvs</span>
</pre>
<pre class="literal-block">
[TESS CBVs, Sector.Camera.CCD : 32.2.4, CBVType : SingleScale, nCBVS : 16,
 TESS CBVs, Sector.Camera.CCD : 32.2.4, CBVType.Band: MultiScale.1, nCBVs : 8,
 TESS CBVs, Sector.Camera.CCD : 32.2.4, CBVType.Band: MultiScale.2, nCBVs : 8,
 TESS CBVs, Sector.Camera.CCD : 32.2.4, CBVType.Band: MultiScale.3, nCBVs : 5,
 TESS CBVs, Sector.Camera.CCD : 32.2.4, CBVType : Spike, nCBVS : 7]
</pre>
<p>There are 5 sets of CBVs, all associated with Sector 32, Camera 2, CCD
4. The number of CBVs per type is also given. Let’s plot the
Single-Scale CBVs, which contain all systematics combined.</p>
<pre class="code ipython3 literal-block">
<span class="n">cbvCorrector</span><span class="o">.</span><span class="n">cbvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8dd99f8810&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_19_1.png" />
<p>The first several CBVs contain most of the systematics. The latter CBVs
pose a greater risk of injecting more noise than helping. The default
behavior in CBVCorrector is to use the first 8 CBVs.</p>
<p>Next, we need to decide what kind of CBV we want to apply. Since we want
to try not to overfit, we are going to use the Multi-Scale and Spike
options (see above for more details). We can specify the type via an
array as indicated below.</p>
<pre class="code ipython3 literal-block">
<span class="n">cbv_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'MultiScale.1'</span><span class="p">,</span> <span class="s1">'MultiScale.2'</span><span class="p">,</span> <span class="s1">'MultiScale.3'</span><span class="p">,</span><span class="s1">'Spike'</span><span class="p">]</span>
</pre>
<p>Since we only want to use the information from the first 8 CBV’s when we
use the SingleScale function, and all the Spike CBCs, we must also
specify this via an array.</p>
<pre class="code ipython3 literal-block">
<span class="n">cbv_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="s1">'ALL'</span><span class="p">]</span>
</pre>
<p>Now we want to check that the application of these vectors will not
under or over-fit our data. There is a handy way of checking this via
the use of a goodness_metric_scan_plot. A “Goodness Metric” value of 0.8
and above tends to indicate a good fit to the data.</p>
<pre class="code ipython3 literal-block">
<span class="n">cbvCorrector</span><span class="o">.</span><span class="n">goodness_metric_scan_plot</span><span class="p">(</span><span class="n">cbv_type</span><span class="o">=</span><span class="n">cbv_type</span><span class="p">,</span> <span class="n">cbv_indices</span><span class="o">=</span><span class="n">cbv_indices</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">1.5e-1</span><span class="p">,</span> <span class="mf">1.5e-1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre>
<pre class="literal-block">
[&lt;matplotlib.lines.Line2D at 0x7f8d8a297290&gt;]
</pre>
<img alt="" src="images/NoiseRemoval/output_25_1.png" />
<p>The above plot indicates that a regularization factor alpha value of
1.5e-1 is appropriate for our data. We can now specify this and check it
via a diagnose method.</p>
<pre class="code ipython3 literal-block">
<span class="n">cbvcorrector</span> <span class="o">=</span> <span class="n">CBVCorrector</span><span class="p">(</span><span class="n">lc_S32</span><span class="p">,</span> <span class="n">interpolate_cbvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cbvcorrector</span><span class="o">.</span><span class="n">correct_gaussian_prior</span><span class="p">(</span><span class="n">cbv_type</span><span class="o">=</span><span class="n">cbv_type</span><span class="p">,</span> <span class="n">cbv_indices</span><span class="o">=</span><span class="n">cbv_indices</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.5e-1</span><span class="p">)</span>
<span class="n">pltAxis</span> <span class="o">=</span> <span class="n">cbvcorrector</span><span class="o">.</span><span class="n">diagnose</span><span class="p">()</span>
<span class="n">pltAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="n">pltAxis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
</pre>
<img alt="" src="output_27_0.png" />
<pre class="code ipython3 literal-block">
<span class="n">cbvcorrector_lc</span> <span class="o">=</span> <span class="n">cbvcorrector</span><span class="o">.</span><span class="n">corrected_lc</span>
<span class="n">cbvcorrector_lc</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8debd37ad0&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_28_1.png" />
<p>We can see that a correction was applied which has removed some of the
slope from our data and also labeled the big spike as an outlier.</p>
<p>The above method can be adjusted more, but for now, let’s move onto our
next method.</p>
</div>
<div class="section" id="the-regressioncorrector">
<h4>The RegressionCorrector</h4>
<p>Remember that this method relies on looking at pixels outside of our
previously defined object aperture to determine our systematics. We can
apply regression correction as follows.</p>
<pre class="code ipython3 literal-block">
<span class="c1">#Import the packages you need</span>
<span class="kn">from</span> <span class="nn">lightkurve.correctors</span> <span class="kn">import</span> <span class="n">RegressionCorrector</span><span class="p">,</span> <span class="n">DesignMatrix</span>
</pre>
<p>Next, we are going to define a design matrix which will contain all the
systematics detected in the pixels outside of our aperture.</p>
<pre class="code ipython3 literal-block">
<span class="c1"># Make a design matrix and pass it to a linear regression corrector</span>
<span class="n">dm</span> <span class="o">=</span> <span class="n">DesignMatrix</span><span class="p">(</span><span class="n">S32</span><span class="o">.</span><span class="n">flux</span><span class="p">[:,</span> <span class="o">~</span><span class="n">aper_new</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">'regressors'</span><span class="p">)</span><span class="c1">#.pca(5).append_constant()</span>
</pre>
<p>We only want the most dominant vectors and so specify the number of
principle componant (PCA) as follows,</p>
<pre class="code ipython3 literal-block">
<span class="n">dm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S32</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dm</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">);</span>
</pre>
<img alt="" src="images/NoiseRemoval/output_35_0.png" />
<p>From this we can see that 10 is excessive and we should probably use
only 5. Let’s do this and plot it up.</p>
<pre class="code ipython3 literal-block">
<span class="n">dm</span> <span class="o">=</span> <span class="n">DesignMatrix</span><span class="p">(</span><span class="n">S32</span><span class="o">.</span><span class="n">flux</span><span class="p">[:,</span> <span class="o">~</span><span class="n">aper_new</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">'regressors'</span><span class="p">)</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">dm</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8db9fa0750&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_37_1.png" />
<p><em>Lightkurve’s RegressionCorrector</em> uses linear algebra to find the
combination of vectors that makes the input light curve closest to zero.
We therefore needed to add one more component - an “offset” term, to be
able to fit the mean level of the light curve. We can do this as shown
above by appending a“constant” to the design matrix.</p>
<pre class="code ipython3 literal-block">
<span class="n">dm</span> <span class="o">=</span> <span class="n">DesignMatrix</span><span class="p">(</span><span class="n">S32</span><span class="o">.</span><span class="n">flux</span><span class="p">[:,</span> <span class="o">~</span><span class="n">aper_new</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">'regressors'</span><span class="p">)</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">append_constant</span><span class="p">()</span>
</pre>
<p>Next we pass this design matrix to the <em>RegressionCorrector</em> which
de-trends the light curves against the vectors.</p>
<pre class="code ipython3 literal-block">
<span class="n">rc</span> <span class="o">=</span> <span class="n">RegressionCorrector</span><span class="p">(</span><span class="n">lc_S32</span><span class="p">)</span>
<span class="n">rc</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
<span class="n">pltAxis</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">diagnose</span><span class="p">()</span>
<span class="n">pltAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="n">pltAxis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

<span class="n">corrected_ffi_lc</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
</pre>
<img alt="" src="images/NoiseRemoval/output_41_0.png" />
<p><strong>HOWEVER!</strong> The <em>RegressionCorrector</em> assumes that you want to remove
the trend and set the light curve to the mean level.</p>
<p>This isn’t true for <em>TESS</em> scattered light, as the <em>TESS</em> FFI light
curves have an additive background. As such, we want to reduce the flux
to the lowest recorded level.</p>
<p>To do this, we can look at the model of the background that
<em>RegressionCorrector</em> built and apply that. This model should never go
below zero, to ensure that this is the case we only subtract the model
flux value at the 5th percentile.</p>
<p>We can then apply all these factors to the FFI light curve using the
following code,</p>
<pre class="code ipython3 literal-block">
<span class="c1"># Optional: Remove the scattered light, allowing for the large offset from scattered light</span>
<span class="n">corrected_ffi_lc</span> <span class="o">=</span> <span class="n">lc_S32</span> <span class="o">-</span> <span class="n">rc</span><span class="o">.</span><span class="n">model_lc</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">model_lc</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">corrected_ffi_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Corrected light curve'</span><span class="p">);</span>
</pre>
<img alt="" src="images/NoiseRemoval/output_43_0.png" />
<p>This has removed all the scattered light and the slope, but again could
be adjusted further. However, we will move onto our final tool.</p>
</div>
<div class="section" id="the-pldcorrector">
<h4>The PLDCorrector</h4>
<p>PLD is built on top of <em>RegressionCorrector</em> and again works by
identifying a set of trends in the pixels surrounding the target star,
and performing linear regression to create a combination of these trends
that effectively models the noise. This noise model is then subtracted
from the uncorrected light curve. The difference between <em>PLDCorrector</em>
and <em>RegressionCorrector</em> is that <em>RegressionCorrector</em> asks the user to
define the pixels, where as <em>PLDCorrector</em> does not.</p>
<p>We will create a <em>PLDCorrector</em> object, and use the default values for
PLDCorrector.correct to remove this scattered light background.</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">lightkurve.correctors</span> <span class="kn">import</span> <span class="n">PLDCorrector</span>
<span class="n">pld_S32</span> <span class="o">=</span> <span class="n">PLDCorrector</span><span class="p">(</span><span class="n">S32</span><span class="p">)</span>
<span class="n">pld_S32</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">pca_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">pltAxis</span> <span class="o">=</span> <span class="n">pld_S32</span><span class="o">.</span><span class="n">diagnose</span><span class="p">()</span>
<span class="n">pltAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="n">pltAxis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="n">pltAxis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

<span class="n">corrected_pldlc</span> <span class="o">=</span> <span class="n">pld_S32</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">pca_components</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre>
<img alt="" src="images/NoiseRemoval/output_45_0.png" />
<p>We can also examine the apertures used to perform this correction. For
<em>TESS</em>, the dominant source of noise is the scattered light background,
so by default only those pixels will be used. In the third panel, we can
see that the background_aperture_mask contains only background pixels,
reducing the risk of contamination by neighboring stars.</p>
<pre class="code ipython3 literal-block">
<span class="n">pld_S32</span><span class="o">.</span><span class="n">diagnose_masks</span><span class="p">();</span>
</pre>
<img alt="" src="images/NoiseRemoval/output_47_0.png" />
<p>Now lets specifically look at our corrected light curve.</p>
<pre class="code ipython3 literal-block">
<span class="n">corrected_pldlc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8d9df0c690&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_49_1.png" />
<p>The large spike from the scattered light has sucessfully been identified
and removed, but there is a slope in our data still. We can determine
from the diagnostic plots that this is due to the application of a flat
background, unlike that which was applied in <em>RegressionCorrection</em>.</p>
<p>Note that there are various componants that can be altered in <em>PLD</em> most
of which can be found
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.correct.html?highlight=pca_components">here</a>.</p>
</div>
</div>
<div class="section" id="comparison">
<h3>Comparison</h3>
<p>Let’s now plot up all of our corrected light curves in addition to the
light curve originally derived from the FFI’s, and compare our results.</p>
<pre class="code ipython3 literal-block">
<span class="c1"># Lets plot and compare the different methods</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">lc_S32</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Uncorrected Light Curve'</span><span class="p">);</span>
<span class="c1"># Plot the CBV-corrected light curve in green</span>
<span class="n">cbvcorrector_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'CBV-corrected Light Curve'</span><span class="p">)</span>
<span class="c1"># Plot the regressor-corrected light curve in blue</span>
<span class="n">corrected_ffi_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Regressor-corrected Light Curve'</span><span class="p">)</span>
<span class="c1"># Plot the PLD-corrected light curve in red</span>
<span class="n">corrected_pldlc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'PLD-corrected Light Curve'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8d8bb519d0&gt;
</pre>
<img alt="" src="images/NoiseRemoval/output_52_1.png" />
</div>
<div class="section" id="summary">
<h3>Summary</h3>
<p>The plot above indicaates that there is no one solution. The result from
the <em>RegressionCorrector</em> seems to have removed the most scattered light
and the slope in the data, whilst retaining the periodicity.</p>
<p>As you may have discovered, removing the noise from the data can be a
complex issue with multiple paths. You should always examine your method
of noise removal and inspect all final products.</p>
<p>The tutorials listed below will aid you in better understanding the fine
details of each process.</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.lightkurve.org/tutorials/2-creating-light-curves/2-3-how-to-use-cbvcorrector.html">Removing noise from Kepler, K2, and TESS light curves using
Cotrending Basis Vectors
(CBVCorrector)</a></li>
<li><a class="reference external" href="https://docs.lightkurve.org/tutorials/2-creating-light-curves/2-3-removing-scattered-light-using-regressioncorrector.html">Removing scattered light from TESS light curves using linear
regression
(RegressionCorrector)</a></li>
<li><a class="reference external" href="https://docs.lightkurve.org/tutorials/2-creating-light-curves/2-3-k2-pldcorrector.html">Removing noise from K2 and TESS light curves using Pixel Level
Decorrelation
(PLDCorrector)</a></li>
</ul>
</div>
</div>

            </div>
        </section>
    </div>

        </div>
    </div>
</div>

<div class="container container-wide" style="margin-top: 1.5em;">
  <footer>

     <div class="container">

      <!-- Partner logos -->  
      <div class="row">
        <div class="col-md-10"> 
          <a href="http://tess.mit.edu/"><img src="./images/partners/mit-logo.png" width="80" alt="MIT Logo"></a> &nbsp;&nbsp;&nbsp;
         <a href="http://www.nasa.gov/"><img src="./images/NASA_logo_vector_lg.png" width="60" alt="NASA Logo"></a> &nbsp;&nbsp;&nbsp;
         <a href="https://www.cfa.harvard.edu/"><img src="./images/partners/CfA_Horizontal_CMYK.png" width="176" alt="CfA Logo"></a> &nbsp;&nbsp;&nbsp;
<!--          <a href="https://www.ll.mit.edu/"><img src="./images/partners/lincoln-laboratory.png" width="50" alt="Lincoln Labs Logo"></a> &nbsp;&nbsp;&nbsp; -->
         <a href="https://http://www.northropgrumman.com/"><img src="./images/partners/Northrop_Grumman.png" width="176" alt="Orbital ATK Logo"></a> &nbsp;&nbsp;&nbsp;
         <a href="http://www.stsci.edu/"><img src="./images/partners/stsci_logo2.png" width="110" alt="STScI Logo"></a> 
        </div>
      </div>

      
      <!-- Related websites -->  
      <div class="row">
        <div class="col-xs-12">
          <h5><i class="fa fa-external-link"></i><span class="icon-label">Related websites:</span></h5>
          <a href="https://nasa.gov/tess" target="_blank">
                  News, Media, and Education Resources
              </a>
          <br/>
          <a href="http://tess.mit.edu/" target="_blank">
                  TESS @ MIT
              </a>
          <br/>
          <a href="http://archive.stsci.edu/tess" target="_blank">
                  TESS @ MAST
              </a>
          <br/>
          <a href="https://heasarc.gsfc.nasa.gov/" target="_blank">
                  High Energy Astrophysics Science Archive Research Center
              </a>
          <br/>
          <a href="http://exoplanetarchive.ipac.caltech.edu" target="_blank">
                  NASA Exoplanet Archive @ IPAC
              </a>
          <br/>
        </div>
      </div>

      <!-- NASA logo and notices -->
      <div class="row" style="margin-top:2em;">
         <div class="col-md-10"> <a href="http://www.nasa.gov/"><img src="./images/NASA_logo_vector_lg.png" width="30" alt="NASA Logo"></a> 
         Last modified: Wed 14 September 2022
            &middot; Editor: Thomas Barclay &middot; NASA Official: Patricia T Boyd 
            &middot; <a href="http://www.nasa.gov/about/highlights/HP_Privacy.html">Privacy Policy and Important Notices</a><p></p>         </div>
         <div class="col-md-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
    </div>

  </footer>
</div>

<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>

    <script src="./theme/js/bodypadding.js"></script>
<!-- Analytics scripts -->
<script language="javascript" id="_fed_an_ua_tag" src="//dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NASA"></script>
<script language="javascript" id="_fed_an_ua_tag" src="//dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NASA&subagency=GSFC&dclink=true"></script>

<script src="./theme/js/drn.js"></script>

</body>
</html>